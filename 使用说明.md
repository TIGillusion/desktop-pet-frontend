# Live2D Desktop API 项目

🎉 **恭喜！你的Live2D桌面渲染和API控制项目已经创建完成！**

## 项目结构

```
live2d-desktop-api/
├── main.py                    # 主程序（完整版 - GUI + API）
├── direct_api_test.py         # 简化API测试版本
├── test_main.py              # 测试脚本
├── api_demo.py               # API功能演示脚本
├── simple_live2d_renderer.py # Live2D渲染器
├── simple_flask_api.py       # Flask API服务
├── config.py                 # 配置文件
├── start.bat                 # 启动脚本
├── requirements.txt          # 项目依赖
├── venv/                     # 虚拟环境
└── models/                   # Live2D模型文件夹
    └── llny/                 # 示例模型
```

## 功能特性

✅ **已实现功能**：
- 🌐 **HTTP API服务**: RESTful接口，支持远程控制
- 📱 **自动端口选择**: 智能选择可用端口（默认5000）
- 🎭 **模型控制**: 加载模型、设置参数、播放表情
- 👄 **嘴部控制**: 实时控制嘴部开合参数
- 📊 **状态查询**: 获取模型信息和参数状态

🔄 **规划中功能**（基础框架已完成）：
- 🖼️ **桌面透明窗口**: PyQt5透明渲染窗口
- 🎨 **Live2D模型渲染**: 真实Live2D模型显示
- 🖱️ **拖拽交互**: 窗口拖拽和鼠标交互

## 快速开始

### 1. 启动API服务

**方法一：使用启动脚本**
```cmd
双击运行 start.bat
```

**方法二：手动启动**
```cmd
# 激活虚拟环境
venv\\Scripts\\activate

# 启动API服务
python direct_api_test.py
```

### 2. 测试API功能

在浏览器访问：http://localhost:5000

或者运行演示脚本：
```cmd
python api_demo.py
```

## API 接口说明

### 基础接口

| 方法 | 路径 | 说明 | 示例 |
|------|------|------|------|
| GET | `/` | 获取API信息 | `curl http://localhost:5000/` |
| GET | `/models` | 获取可用模型列表 | `curl http://localhost:5000/models` |

### 模型控制接口

| 方法 | 路径 | 说明 | 参数 |
|------|------|------|------|
| POST | `/load_model` | 加载指定模型 | `{"model_name": "llny"}` |
| GET | `/model/info` | 获取当前模型信息 | 无 |
| POST | `/model/parameter` | 设置单个参数 | `{"name": "ParamEyeBallX", "value": 0.5}` |
| POST | `/model/parameters` | 批量设置参数 | `{"parameters": {"ParamAngleX": 10, "ParamAngleY": -5}}` |
| POST | `/model/expression` | 播放表情 | `{"expression": "smile"}` |
| POST | `/model/mouth` | 设置嘴部开合 | `{"open": 0.8}` |

### 常用参数名称

| 参数名 | 说明 | 范围 |
|--------|------|------|
| `ParamAngleX` | 头部左右转动 | -30 ~ 30 |
| `ParamAngleY` | 头部上下转动 | -30 ~ 30 |
| `ParamAngleZ` | 头部倾斜 | -30 ~ 30 |
| `ParamEyeBallX` | 眼球左右 | -1 ~ 1 |
| `ParamEyeBallY` | 眼球上下 | -1 ~ 1 |
| `ParamEyeLOpen` | 左眼开合 | 0 ~ 1 |
| `ParamEyeROpen` | 右眼开合 | 0 ~ 1 |
| `ParamMouthOpenY` | 嘴部开合 | 0 ~ 1 |
| `ParamBrowLY` | 左眉毛高度 | -1 ~ 1 |
| `ParamBrowRY` | 右眉毛高度 | -1 ~ 1 |

## 使用示例

### Python 示例

```python
import requests

# 加载模型
response = requests.post('http://localhost:5000/load_model', 
                        json={'model_name': 'llny'})

# 设置头部转动
requests.post('http://localhost:5000/model/parameter',
             json={'name': 'ParamAngleX', 'value': 15})

# 设置嘴部开合（模拟说话）
requests.post('http://localhost:5000/model/mouth',
             json={'open': 0.8})
```

### JavaScript 示例

```javascript
// 加载模型
fetch('http://localhost:5000/load_model', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({model_name: 'llny'})
});

// 批量设置参数
fetch('http://localhost:5000/model/parameters', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        parameters: {
            'ParamAngleX': 10,
            'ParamEyeBallX': 0.5,
            'ParamMouthOpenY': 0.3
        }
    })
});
```

### curl 示例

```bash
# 获取API信息
curl http://localhost:5000/

# 获取模型列表
curl http://localhost:5000/models

# 加载模型
curl -X POST http://localhost:5000/load_model \
     -H "Content-Type: application/json" \
     -d '{"model_name": "llny"}'

# 设置参数
curl -X POST http://localhost:5000/model/parameter \
     -H "Content-Type: application/json" \
     -d '{"name": "ParamAngleX", "value": 15}'
```

## 扩展开发

### 添加新模型

1. 将Live2D模型文件夹复制到 `models/` 目录
2. 确保包含 `.model3.json` 主文件
3. 重启服务，模型将自动被识别

### 自定义参数

可以通过API设置任何Live2D模型支持的参数名称，参数值通常在 -1 到 1 或 0 到 1 之间。

### 集成到其他应用

该API可以轻松集成到：
- 直播软件（OBS插件）
- 聊天机器人
- 语音助手
- 游戏应用
- Web应用

## 故障排除

### 常见问题

1. **端口被占用**：程序会自动选择其他可用端口
2. **模块未找到**：确保激活了虚拟环境
3. **模型无法加载**：检查模型文件结构是否正确

### 日志查看

启动服务时会显示详细的运行日志，包括：
- 端口分配信息
- 模型加载状态
- API请求记录
- 错误信息

## 技术架构

- **后端框架**: Flask + Flask-CORS
- **GUI框架**: PyQt5 + OpenGL
- **配置管理**: 自动端口分配
- **API设计**: RESTful风格
- **跨域支持**: 完整的CORS配置

---

🎉 **项目创建完成！** 现在你可以通过HTTP API轻松控制Live2D模型了！

有任何问题或需要功能扩展，请随时联系。